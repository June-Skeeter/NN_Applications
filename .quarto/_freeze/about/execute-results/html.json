{
  "hash": "7b5b7d62c4d08e525a8b840aa5450c34",
  "result": {
    "markdown": "---\ntitle: A Framework for Applying Neural Networks to Eddy Covariance Data\nformat:\n  revealjs:\n    code-fold: true\n    controls: true\n    navigation-mode: linear\n    controls-layout: bottom-right\n    controls-tutorial: true\n    slide-number: true\n    show-slide-number: all\n    pdfMaxPagesPerSlide: 1\nauthor:\n  - name: Dr. June Skeeter\n    email: june.skeeter@ubc.ca\n    url: 'https://github.com/June-Skeeter'\n    affiliations:\n      - ref: UBC\naffiliations:\n  - id: UBC\n    name: University of British Columbia\n    department: Department of Geography\n    address: 1984 West Mall\n    city: 'Vancouver, BC, Canada'\n    postal-code: V6T 1Z2\nkeywords:\n  - Eddy Covariance\n  - Micrometeorology\n  - Neural Networks\n  - Modelling\nciteproc: true\nbibliography: ML_EC.bib\n---\n\n## Eddy Covariance\n\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\nEcosystem-scale fluxes of energy, water, and trace gases.\n\n* Spatially integrated, semi-continuous\n\n* Noisy, voluminous data\n    * Ideally suited for NN analysis!\n\n:::\n\n::: {.column width=\"50%\"}\n\n![](images/BB1_System.jpg)\n\n:::\n\n::::\n\n\n## Neural networks\n\nPowerful machine learning algorithms that are well suited for non-linear, multi-variate response functions.\n\n* **Universal approximators**: can map any continuous function to an arbitrary degree of accuracy.\n    * Given sufficient \"hidden nodes\", will fit **any** pattern in a dataset\n        * Care must be taken to ensure the patterns are real\n\n* Capable of interpolation and extrapolation\n\n## Neural networks\n\n:::: {.columns}\n\n::: {.column width=\"30%\"}\n\n<!-- ### Limitations -->\n\n* Computationally expensive\n\n* Prone to over-fitting\n\n* \"Black Boxes\"\n\n:::\n\n::: {.column width=\"70%\"}\n\n<!-- ### Solutions -->\n\nAdvances in hardware (GPU processing) and software (Tensorflow)\n\nEarly stopping, ensembling, & input normalization\n\nInspecting partial derivative allows visualization of model's internal workings\n\n:::\n\n::::\n\n# Objectives\n\nProvide a framework for applying NN models can be applied to EC data for both descriptive analysis and inferential modelling. \n \n* The [github repository](https://github.com/June-Skeeter/NN_Applications) linked to this presentation has Python code with functional examples that can be used to apply NN models.\n\n## Key Procedures\n\n* Early stopping: End training metrics (e.g., MSE) fail to improve for *e* training epochs\n    * *e* = 2 typically provides a robust, generalizable model\n\n* Ensembling: Train a set of N randomly initialled models on N unique interactions of training/testing data\n    * A small ensemble for ~10 models is sufficient in most applications\n\n* Input normalization: Z-norm scale all inputs to improve training\n\n## Key Procedures\n\n* Feature inspection: Calculating partial first (and second) derivatives of each input\n    * Sum of squared derivatives gives relative influence of each input over output\n    * Plotting model derivatives to help ensure mapped relationships are physically plausible\n        * An **essential step** and **key advantage** of NN models\n\n## A Simple Example\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n\n\nThe Vapor Pressure Deficit (VPD):\n\n* Increases exponentially as a function of air temperature (Ta)\n* Decreases linearly as a function of relative humidity (RH).\n\n<!-- \n$$ ea_H = 0.61365*np.exp((17.502*Ta)/(240.97+Ta))$$\n$$e_H = RH*ea_H/100$$\n$$VPD = (ea_H - e_H)*10$$ -->\n\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell layout-ncol='1' execution_count=1}\n\n::: {.cell-output .cell-output-display}\n![VPD over a range of Ta, and RH values](about_files/figure-revealjs/estimating-vpd-output-1.png){#estimating-vpd width=469 height=468}\n:::\n:::\n\n\n:::\n\n::::\n\n\n## Partial Derivatives\n\n::: {.cell layout-ncol='1' execution_count=2}\n\n::: {#derivatives-of-vpd .cell-output .cell-output-display execution_count=430}\n```\n-1.7763568394002505e-14\n```\n\nThis plot shows the partial first derivatives of VPD\n:::\n:::\n\n\n## Example Data\n\nBB1 Flux tower was established in 2015.\n\n::: {.cell execution_count=3}\n\n::: {.cell-output .cell-output-stdout}\n```\n                           TA         RH  FCO2  FCH4       PPFD    P  qc_FCO2  \\\nTimeStamp                                                                       \n2015-01-01 00:30:00 -5.184118  93.123276   NaN   NaN  13.415596  0.0      NaN   \n2015-01-01 01:00:00 -5.582586  93.134880   NaN   NaN  13.415596  0.0      NaN   \n2015-01-01 01:30:00 -5.273667  93.411385   NaN   NaN  13.415596  0.0      NaN   \n2015-01-01 02:00:00 -5.527215  93.178055   NaN   NaN  13.415596  0.0      NaN   \n2015-01-01 02:30:00 -5.515291  93.384380   NaN   NaN  13.415596  0.0      NaN   \n\n                     qc_FCH4  USTAR      TS_1      TS_2      TS_3   U  dir  \\\nTimeStamp                                                                    \n2015-01-01 00:30:00      NaN    NaN  1.479264  2.179019  6.948500 NaN  NaN   \n2015-01-01 01:00:00      NaN    NaN  1.446164  2.144506  6.990202 NaN  NaN   \n2015-01-01 01:30:00      NaN    NaN  1.485793  2.158336  6.956882 NaN  NaN   \n2015-01-01 02:00:00      NaN    NaN  1.430985  2.130317  6.998434 NaN  NaN   \n2015-01-01 02:30:00      NaN    NaN  1.461107  2.125426  6.966145 NaN  NaN   \n\n                     WTD_raw  WTD  \nTimeStamp                          \n2015-01-01 00:30:00      NaN  NaN  \n2015-01-01 01:00:00      NaN  NaN  \n2015-01-01 01:30:00      NaN  NaN  \n2015-01-01 02:00:00      NaN  NaN  \n2015-01-01 02:30:00      NaN  NaN  \n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=431}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>TA</th>\n      <th>RH</th>\n      <th>FCO2</th>\n      <th>FCH4</th>\n      <th>PPFD</th>\n      <th>P</th>\n      <th>qc_FCO2</th>\n      <th>qc_FCH4</th>\n      <th>USTAR</th>\n      <th>TS_1</th>\n      <th>TS_2</th>\n      <th>TS_3</th>\n      <th>U</th>\n      <th>dir</th>\n      <th>WTD_raw</th>\n      <th>WTD</th>\n      <th>VPD</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>140249.0</td>\n      <td>140104.0</td>\n      <td>37260.0</td>\n      <td>42498.0</td>\n      <td>140256.0</td>\n      <td>139996.0</td>\n      <td>91746.0</td>\n      <td>74387.0</td>\n      <td>71373.0</td>\n      <td>138046.0</td>\n      <td>138042.0</td>\n      <td>138042.0</td>\n      <td>71373.0</td>\n      <td>92583.0</td>\n      <td>129783.0</td>\n      <td>1969.0</td>\n      <td>140104.0</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>10.6</td>\n      <td>84.2</td>\n      <td>-0.3</td>\n      <td>53.0</td>\n      <td>216.1</td>\n      <td>0.1</td>\n      <td>0.8</td>\n      <td>0.7</td>\n      <td>0.2</td>\n      <td>11.7</td>\n      <td>11.6</td>\n      <td>10.2</td>\n      <td>1.5</td>\n      <td>168.7</td>\n      <td>90.8</td>\n      <td>0.0</td>\n      <td>2.8</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>6.9</td>\n      <td>15.5</td>\n      <td>4.3</td>\n      <td>70.0</td>\n      <td>365.2</td>\n      <td>0.3</td>\n      <td>0.8</td>\n      <td>0.7</td>\n      <td>0.1</td>\n      <td>5.4</td>\n      <td>5.2</td>\n      <td>4.7</td>\n      <td>1.2</td>\n      <td>84.4</td>\n      <td>94.8</td>\n      <td>0.1</td>\n      <td>3.9</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>-13.8</td>\n      <td>0.0</td>\n      <td>-49.3</td>\n      <td>-199.9</td>\n      <td>-4.5</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-23.0</td>\n      <td>-25.2</td>\n      <td>-19.6</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>-5883.7</td>\n      <td>0.0</td>\n      <td>-0.0</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>5.9</td>\n      <td>74.9</td>\n      <td>-1.7</td>\n      <td>9.6</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.1</td>\n      <td>6.7</td>\n      <td>6.7</td>\n      <td>7.2</td>\n      <td>0.5</td>\n      <td>97.8</td>\n      <td>61.7</td>\n      <td>0.0</td>\n      <td>0.3</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>10.3</td>\n      <td>89.6</td>\n      <td>-0.1</td>\n      <td>34.8</td>\n      <td>13.4</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.1</td>\n      <td>11.8</td>\n      <td>11.7</td>\n      <td>10.2</td>\n      <td>1.3</td>\n      <td>158.9</td>\n      <td>70.3</td>\n      <td>0.0</td>\n      <td>1.2</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>15.2</td>\n      <td>96.5</td>\n      <td>0.7</td>\n      <td>90.5</td>\n      <td>274.8</td>\n      <td>0.0</td>\n      <td>1.0</td>\n      <td>1.0</td>\n      <td>0.2</td>\n      <td>16.7</td>\n      <td>16.4</td>\n      <td>14.6</td>\n      <td>2.2</td>\n      <td>247.9</td>\n      <td>81.0</td>\n      <td>0.0</td>\n      <td>3.7</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>38.0</td>\n      <td>100.2</td>\n      <td>49.8</td>\n      <td>695.1</td>\n      <td>1883.9</td>\n      <td>11.5</td>\n      <td>2.0</td>\n      <td>2.0</td>\n      <td>2.6</td>\n      <td>24.2</td>\n      <td>21.8</td>\n      <td>17.2</td>\n      <td>8.3</td>\n      <td>360.0</td>\n      <td>5813.5</td>\n      <td>2.4</td>\n      <td>42.4</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](about_files/figure-revealjs/cell-4-output-3.png){width=662 height=374}\n:::\n:::\n\n\n## Artificial Gaps\n\n::: {#fig-format .cell layout-ncol='1' execution_count=4}\n\n::: {.cell-output .cell-output-stdout}\n```\n(63812, 17) (76444, 17)\n[-1  1]\n[2 3]\n```\n:::\n:::\n\n\n## Next Steps & Speculations\n\n* u* filtering\n* Flux footprint calculations\n\n## Conclusions\n\nThey offer the user more control over the structure of the model and inspection of the model derivatives provides a method for validating that the relationships mapped by a model are physically plausible.\n\n## Questions\n\n",
    "supporting": [
      "about_files/figure-revealjs"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}